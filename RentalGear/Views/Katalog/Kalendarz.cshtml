@model Sprzet
@{ ViewData["Title"] = $"Dostępność - {Model.Nazwa}"; }

<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb" style="--bs-breadcrumb-divider-color:var(--text-secondary)">
        <li class="breadcrumb-item"><a asp-action="Index">Katalog</a></li>
        <li class="breadcrumb-item"><a asp-action="Szczegoly" asp-route-id="@Model.Id">@Model.Nazwa</a></li>
        <li class="breadcrumb-item active">Kalendarz</li>
    </ol>
</nav>

<div class="page-header">
    <h1 class="page-title"><i class="bi bi-calendar3 me-2"></i>Dostępność: @Model.Producent @Model.Nazwa</h1>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <div id="kalendarz"></div>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">Legenda</div>
            <div class="card-body">
                <p><span class="badge bg-warning me-2">●</span> Oczekujące na potwierdzenie</p>
                <p><span class="badge bg-danger me-2">●</span> Zarezerwowane</p>
                <p class="mb-0 text-secondary">Dni bez oznaczenia są dostępne</p>
            </div>
        </div>
        <div class="card mt-3">
            <div class="card-body">
                <h6>Chcesz wypożyczyć?</h6>
                <p class="text-secondary small">Dodaj sprzęt do koszyka i wybierz termin.</p>
                @if (User.Identity!.IsAuthenticated && Model.IloscDostepna > 0)
                {
                    <form asp-controller="Koszyk" asp-action="Dodaj" method="post">
                        <input type="hidden" name="id" value="@Model.Id">
                        <button type="submit" class="btn btn-primary w-100"><i class="bi bi-cart-plus me-2"></i>Dodaj do koszyka</button>
                    </form>
                }
                else if (!User.Identity.IsAuthenticated)
                {
                    <a asp-controller="Konto" asp-action="Logowanie" class="btn btn-outline-primary w-100">Zaloguj się</a>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
document.addEventListener('DOMContentLoaded', function() {
    var cal = new FullCalendar.Calendar(document.getElementById('kalendarz'), {
        initialView: 'dayGridMonth',
        locale: 'pl',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth'
        },
        events: function(info, successCallback, failureCallback) {
            fetch('/Katalog/GetKalendarzEvents?id=@Model.Id&start=' + info.startStr + '&end=' + info.endStr)
                .then(r => r.json())
                .then(data => successCallback(data))
                .catch(() => failureCallback());
        },
        height: 500
    });
    cal.render();
});
</script>
<style>
    .fc { --fc-border-color: var(--border-color); --fc-page-bg-color: transparent; }
    .fc .fc-daygrid-day-number { color: var(--text-primary); }
    .fc .fc-col-header-cell-cushion { color: var(--text-primary); }
    .fc-theme-standard td, .fc-theme-standard th { border-color: var(--border-color); }
    .fc .fc-button-primary { background: var(--accent-blue); border-color: var(--accent-blue); }
    .fc-day-today { background: var(--bg-tertiary) !important; }
</style>
}